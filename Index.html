<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù…ÙˆÙ„Ù‘Ø¯ Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª ÙÙ„Ø³ÙÙŠØ© Ù…ØªØ¹Ø¯Ø¯Ø© Ù…Ø¹ Ø­ÙˆØ§Ø´ÙŠ</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.0.2/docx.umd.min.js"></script>
  <style>
    body { font-family: 'Tahoma'; direction: rtl; background: #f4f4f4; padding: 20px; }
    textarea, input { width: 100%; padding: 10px; margin-top: 10px; font-size: 16px; }
    button { padding: 10px 20px; background: #4a148c; color: white; border: none; cursor: pointer; margin-top: 15px; }
    label { display: block; font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>

<h2>ğŸ“˜ Ø£Ø¯Ø§Ø© Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª ÙÙ„Ø³ÙÙŠØ© Ù…ØªØ¹Ø¯Ø¯Ø© Ù…Ø¹ Ø­ÙˆØ§Ø´ÙŠ ÙˆØªØµØ¯ÙŠØ± Word</h2>

<label>ğŸ“ Ø§Ù„ÙÙ‚Ø±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© (Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª Ø¨ÙŠÙ† Ø¹Ù„Ø§Ù…Ø§Øª " "):</label>
<textarea id="paragraph" rows="6" placeholder='Ù…Ø«Ø§Ù„: ÙŠØ±Ù‰ Ø£ÙÙ„Ø§Ø·ÙˆÙ† Ø£Ù† "Ø§Ù„Ø¹Ø¯Ø§Ù„Ø© ØªØªØ­Ù‚Ù‚ Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ¤Ø¯ÙŠ ÙƒÙ„ ÙØ±Ø¯ Ù…Ø§ ÙŠÙ†Ø§Ø³Ø¨ Ø·Ø¨ÙŠØ¹ØªÙ‡". ÙˆÙŠØ¤ÙƒØ¯ Ø£Ø±Ø³Ø·Ùˆ Ø£Ù† "Ø§Ù„ÙØ¶ÙŠÙ„Ø© Ù‡ÙŠ ÙˆØ³Ø· Ø¨ÙŠÙ† Ø§Ù„Ø¥ÙØ±Ø§Ø· ÙˆØ§Ù„ØªÙØ±ÙŠØ·".'></textarea>

<label>ğŸ“š Ø§Ù„Ø­ÙˆØ§Ø´ÙŠ (Ù…ØµØ¯Ø± Ù„ÙƒÙ„ Ø§Ù‚ØªØ¨Ø§Ø³ØŒ Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯):</label>
<textarea id="footnotes" rows="5" placeholder='1. Ø£ÙÙ„Ø§Ø·ÙˆÙ†ØŒ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ©ØŒ ØªØ±Ø¬Ù…Ø©: ÙƒÙ…Ø§Ù„ Ø§Ù„Ø­Ø§Ø¬Ø› Ø·1ØŒ Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„ÙƒØªØ§Ø¨ØŒ Øµ 112.
2. Ø£Ø±Ø³Ø·ÙˆØŒ Ø§Ù„Ø£Ø®Ù„Ø§Ù‚ Ø¥Ù„Ù‰ Ù†ÙŠÙ‚ÙˆÙ…Ø§Ø®ÙˆØ³ØŒ ØªØ±Ø¬Ù…Ø©: Ø£Ø­Ù…Ø¯ Ù„Ø·ÙÙŠ Ø§Ù„Ø³ÙŠØ¯Ø› Ø·2ØŒ Ø¯Ø§Ø± Ø§Ù„ÙÙƒØ±ØŒ Øµ 77.'></textarea>

<button onclick="generateDoc()">ğŸ’¾ ØªÙˆÙ„ÙŠØ¯ Ù…Ù„Ù Word</button>

<script>
async function generateDoc() {
  const { Document, Packer, Paragraph, TextRun, FootnoteReferenceRun, Footnote, AlignmentType } = window.docx;

  const paragraph = document.getElementById("paragraph").value;
  const footnotesRaw = document.getElementById("footnotes").value.trim().split("\n");

  const quoteRegex = /"([^"]+)"/g;
  const matches = [...paragraph.matchAll(quoteRegex)];

  let pointer = 0, segments = [];

  matches.forEach((match, idx) => {
    const start = match.index;
    const end = match.index + match[0].length;

    segments.push({
      before: paragraph.slice(pointer, start),
      quote: match[1],
      index: idx + 1,
    });

    pointer = end;
  });

  const after = paragraph.slice(pointer);
  const children = [];

  segments.forEach(seg => {
    children.push(new TextRun(seg.before));
    children.push(new TextRun(`"${seg.quote}"`));
    children.push(new FootnoteReferenceRun(seg.index));
  });

  children.push(new TextRun(after));

  const footnotes = footnotesRaw.map((f, i) => new Footnote({
    id: i + 1,
    children: [new Paragraph(f.replace(/^\d+\.\s*/, ""))]
  }));

  const doc = new Document({
    footnotes: { children: footnotes },
    sections: [{
      properties: {},
      children: [
        new Paragraph({
          text: "ğŸ“– ÙÙ‚Ø±Ø© ÙÙ„Ø³ÙÙŠØ© Ù…Ø¹ Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª Ù…Ø±Ù‚Ù…Ø©",
          heading: "Heading1",
          alignment: AlignmentType.CENTER
        }),
        new Paragraph({ children })
      ]
    }]
  });

  const blob = await Packer.toBlob(doc);
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª_Ù…Ø¹_Ø­ÙˆØ§Ø´ÙŠ.docx";
  link.click();
}
</script>

</body>
</html>
