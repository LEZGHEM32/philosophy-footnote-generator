<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“˜ Ø£Ø¯Ø§Ø© ÙÙ„Ø³ÙÙŠØ© Ø°ÙƒÙŠØ©</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.0.2/docx.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
  <style>
    body { font-family: 'Arial'; direction: rtl; background: #f4f4f4; padding: 20px; }
    textarea, input, select { width: 100%; padding: 10px; margin-top: 10px; font-size: 16px; border-radius: 6px; border: 1px solid #ccc; }
    button { padding: 12px 20px; margin-top: 15px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; }
    #generateBtn { background: #4a148c; color: white; }
    #pdfBtn { background: #00897b; color: white; }
    #previewBox { background: white; padding: 15px; margin-top: 20px; border: 1px solid #ccc; border-radius: 8px; white-space: pre-wrap; }
    #confirmBox { background: #fff3cd; border: 1px solid #ffeeba; padding: 15px; margin-top: 15px; border-radius: 8px; display: none; }
  </style>
</head>
<body>

<h2>ğŸ“˜ Ø£Ø¯Ø§Ø© Ø°ÙƒÙŠØ© Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª ÙÙ„Ø³ÙÙŠØ© Ù…Ù† Ù…Ù„ÙØ§Øª Ø£Ùˆ Ø±ÙˆØ§Ø¨Ø·</h2>

<label>ğŸ“‚ Ø­Ù…Ù‘Ù„ Ù…Ù„Ù Ù†ØµÙŠ (.txtØŒ .pdfØŒ .docx):</label>
<input type="file" id="fileInput" accept=".txt,.pdf,.docx">

<label>ğŸŒ Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø± Ù„ÙƒØªØ§Ø¨ Ø£Ùˆ Ù…Ù‚Ø§Ù„:</label>
<input type="url" id="urlInput" placeholder="https://example.com/book.pdf">

<label>ğŸ¯ Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø© / Ø§Ù„ÙØµÙ„:</label>
<input type="text" id="topic" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø¹Ø¯Ø§Ù„Ø© Ø¹Ù†Ø¯ Ø£ÙÙ„Ø§Ø·ÙˆÙ†">

<button id="generateBtn" onclick="analyzeInput()">ğŸ” ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø¹Ø±Ø¶ Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª Ø¨Ø¯ÙŠÙ„Ø©</button>
<button id="pdfBtn" onclick="exportToPDF()">ğŸ“„ ØªØµØ¯ÙŠØ± ÙƒÙ€ PDF</button>

<div id="previewBox" hidden></div>
<div id="confirmBox">
  <p>ğŸ“¦ ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª. Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ù„ØªØ­Ø±ÙŠØ± Ø§Ù„Ø°Ø§ÙƒØ±Ø©ØŸ</p>
  <button onclick="deleteTempFile()">âœ… Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù</button>
  <button onclick="keepTempFile()">âŒ Ù„Ø§ØŒ Ø§Ø­ØªÙØ¸ Ø¨Ù‡ Ù…Ø¤Ù‚ØªÙ‹Ø§</button>
</div>

<script>
let results = [];
let tempFileURL = null;
const backupQuotes = [
  {
    quote: "Ø§Ù„Ø¹Ø¯Ø§Ù„Ø© ØªØªØ­Ù‚Ù‚ Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ¤Ø¯ÙŠ ÙƒÙ„ ÙØ±Ø¯ Ù…Ø§ ÙŠÙ†Ø§Ø³Ø¨ Ø·Ø¨ÙŠØ¹ØªÙ‡.",
    source: "Ø£ÙÙ„Ø§Ø·ÙˆÙ†ØŒ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ©ØŒ Ø¯Ø§Ø± Ø§Ù„Ù…Ø¹Ø§Ø±ÙØŒ Ø·1ØŒ 1992ØŒ Øµ 112."
  },
  {
    quote: "Ø§Ù„ÙØ¶ÙŠÙ„Ø© Ù‡ÙŠ ÙˆØ³Ø· Ø¨ÙŠÙ† Ø§Ù„Ø¥ÙØ±Ø§Ø· ÙˆØ§Ù„ØªÙØ±ÙŠØ·.",
    source: "Ø£Ø±Ø³Ø·ÙˆØŒ Ø§Ù„Ø£Ø®Ù„Ø§Ù‚ Ø¥Ù„Ù‰ Ù†ÙŠÙ‚ÙˆÙ…Ø§Ø®ÙˆØ³ØŒ ØªØ±Ø¬Ù…Ø© Ø£Ø­Ù…Ø¯ Ù„Ø·ÙÙŠ Ø§Ù„Ø³ÙŠØ¯ØŒ Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„Ù…ØµØ±ÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„ÙƒØªØ§Ø¨ØŒ Ø·2ØŒ Øµ 77."
  },
  {
    quote: "Ø§Ù„ÙˆØ¬ÙˆØ¯ ÙŠØ³Ø¨Ù‚ Ø§Ù„Ù…Ø§Ù‡ÙŠØ©.",
    source: "Ø³Ø§Ø±ØªØ±ØŒ Ø§Ù„ÙˆØ¬ÙˆØ¯ ÙˆØ§Ù„Ø¹Ø¯Ù…ØŒ ØªØ±Ø¬Ù…Ø© ÙƒØ±ÙŠÙ… Ø§Ù„ØµØ§Ù„Ø­ØŒ Ø¯Ø§Ø± Ø§Ù„ØªÙ†ÙˆÙŠØ±ØŒ Ø·1ØŒ Øµ 33."
  }
];

function analyzeInput() {
  const file = document.getElementById("fileInput").files[0];
  const url = document.getElementById("urlInput").value.trim();
  const topic = document.getElementById("topic").value.trim();

  if (file) {
    const ext = file.name.split('.').pop().toLowerCase();
    if (ext === 'txt') {
      const reader = new FileReader();
      reader.onload = e => processText(e.target.result, topic);
      reader.readAsText(file);
      tempFileURL = URL.createObjectURL(file);
    } else if (ext === 'docx') {
      const reader = new FileReader();
      reader.onload = e => {
        mammoth.extractRawText({ arrayBuffer: e.target.result })
          .then(res => {
            processText(res.value, topic);
            tempFileURL = URL.createObjectURL(file);
          });
      };
      reader.readAsArrayBuffer(file);
    } else if (ext === 'pdf') {
      const reader = new FileReader();
      reader.onload = async function(e) {
        const typedarray = new Uint8Array(e.target.result);
        const pdf = await pdfjsLib.getDocument({ data: typedarray }).promise;
        let text = '';
        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const content = await page.getTextContent();
          text += content.items.map(item => item.str).join(' ') + '\n';
        }
        processText(text, topic);
        tempFileURL = URL.createObjectURL(file);
      };
      reader.readAsArrayBuffer(file);
    } else {
      alert("ØµÙŠØºØ© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø©ØŒ Ø§Ø³ØªØ®Ø¯Ù… .txt Ø£Ùˆ .pdf Ø£Ùˆ .docx");
    }
  } else {
    results = backupQuotes.slice(0, 3).map((item, i) => {
      return {
        quote: item.quote,
        footnote: item.source,
        index: i + 1,
        analysis: `Ù‡Ø°Ø§ Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³ ÙŠØ±ØªØ¨Ø· Ø¨Ù…ÙˆØ¶ÙˆØ¹ "${topic}"ØŒ ÙˆÙŠÙØ¸Ù‡Ø± ØªØµÙˆØ±Ù‹Ø§ ÙÙ„Ø³ÙÙŠÙ‹Ø§ Ù…Ø£Ø®ÙˆØ°Ù‹Ø§ Ù…Ù† Ù…ØµØ¯Ø± Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ Ù…ÙˆØ«ÙˆÙ‚.`
      };
    });
    displayResults();
  }
}

function processText(text, topic) {
  const matches = [...text.matchAll(/"([^"]{10,200})"/g)].slice(0, 5);
  results = matches.map((match, i) => {
    return {
      quote: match[1],
      footnote: `Ø§Ù‚ØªØ¨Ø§Ø³ Ù…Ø£Ø®ÙˆØ° Ù…Ù† Ø§Ù„Ù…Ù„Ù Ø­ÙˆÙ„ Ù…ÙˆØ¶ÙˆØ¹: ${topic}`,
      index: i + 1,
      analysis: `Ù‡Ø°Ø§ Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³ ÙŠØ±ØªØ¨Ø· Ø¨Ù…ÙˆØ¶ÙˆØ¹ "${topic}"ØŒ ÙˆÙŠÙØ¸Ù‡Ø± Ù…Ù†Ø¸ÙˆØ±Ù‹Ø§ ÙÙ„Ø³ÙÙŠÙ‹Ø§ ÙŠÙØ­ØªÙ…Ù„ Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ø­ÙˆØ±ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ù†Ø¸Ø±ÙŠ.`
    };
  });
  displayResults();
  document.getElementById("confirmBox").style.display = "block";
}

function deleteTempFile() {
  if (tempFileURL) {
    URL.revokeObjectURL(tempFileURL);
    tempFileURL = null;
    alert("âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¤Ù‚Øª Ø¨Ù†Ø¬Ø§Ø­.");
  }
  document.getElementById("confirmBox").style.display = "none";
}

function keepTempFile() {
  alert("ğŸ•’ Ø³ÙŠØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ù…Ù„Ù Ù…Ø¤Ù‚ØªÙ‹Ø§ Ø­ØªÙ‰ ØªØºÙ„Ù‚ Ø§Ù„ØµÙØ­Ø©.");
  document.getElementById("confirmBox").style.display = "none";
}

function displayResults() {
  let preview = "";
  results.forEach(r => {
    preview += `"${r.quote}"Â¹[${r.index}]\nğŸ” ØªØ­Ù„ÙŠÙ„: ${r.analysis}\n\n`;
  });
  document.getElementById("previewBox").textContent = preview;
  document.getElementById("previewBox").hidden = false;
}

function exportToPDF() {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  pdf.setFont("Arial");
  pdf.setFontSize(12);
  pdf.text(document.getElementById("previewBox").textContent, 10, 10, { maxWidth: 180 });
  pdf.save("ØªØ­Ù„ÙŠÙ„_ÙÙ„Ø³ÙÙŠ.pdf");
}
</script>
</body>
</html>
